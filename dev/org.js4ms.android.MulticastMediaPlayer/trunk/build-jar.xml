<?eclipse.ant.import?>
<project>

	<property file="service.properties" />

	<import file="gen-version.xml" />

	<target name="gen-jar-name" depends="gen-version">
	    <property name="service.jar.name" value="${service.name}.jar"/>
	    <property name="service.jar.file" value="${service.name}__V${service.version}.jar"/>
    </target>

	<target name="build-jar-file" depends="gen-jar-name">

        <!-- Delete all existing versions of the jar file -->
        <delete>
            <fileset dir="libs" includes="${service.name}__V*.*"/>
        </delete>
  
	    <jar destfile="libs/${service.jar.file}">
            <fileset dir="../org.js4ms.util.logging/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.common/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.util.buffer/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.net/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.channels/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.net.udp/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.util/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.io/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.net.ip/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.util.task/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.net.amt/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.net.amt.gateway/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.service/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.service.launcher/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.service.protocol.text/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.service.protocol.text.server/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.service.protocol.rtsp/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.service.protocol.rtsp.server/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.service.protocol.rtsp.server.reflector/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.service.protocol.http/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.service.protocol.http.server/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <fileset dir="../org.js4ms.app.RtspMulticastReflector/bin">
                <include name="**/*.class" />
                <exclude name="**/test/*.class" />
            </fileset>
            <manifest>
                <attribute name="Main-Class" value="${service.package}.${service.class}"/>
                <attribute name="Built-By" value="${user.name}"/>
                <attribute name="Implementation-Vendor" value="${service.vendor}"/>
                <attribute name="Implementation-Title" value="${service.name}"/>
                <attribute name="Implementation-Version" value="${service.version}"/> 
            </manifest>
        </jar>

    </target>

	<target name="clean-jar-file">
        <delete>
            <fileset dir="libs" includes="*.jar"/>
        </delete>
	</target>

</project>
